////// Common site JavaScript functions.




//// Master function that loads all other functions for a page.
function addToPage(newFunction)
    {
    // Check whether functions are already set to run when the page loads.
    if (typeof window.onload != 'function')
        {
        // No other functions are set to run.
        // Set this function to run when the page loads.
        window.onload = newFunction;
        }
    else
        {
        // Other functions are already set to run.
        // Store the other functions.
        var existingFunctions = window.onload;

        // Overwrite the existing page load.
        window.onload = function()
            {
            // When the page loads,
            // run the stored functions first,
            // then the new function.
            existingFunctions();
            newFunction();
            }
        }
    }




//// Open and close to site header menu.
function headerMenuOpenClose(theHeaderMenu, theHeaderMenuImage, newRoot)
    {
    if (
           (newRoot)
        && (theHeaderMenuImage)
        && (theHeaderMenuImage.setAttribute)
        && (theHeaderMenu)
        && (theHeaderMenu.getAttribute)
        && (theHeaderMenu.setAttribute)
       )
        {
        var theHeaderMenuClass = theHeaderMenu.getAttribute('class');

        // Compensate for when 'className' is used instead of 'class'.
        var theHeaderMenuClassName = theHeaderMenu.getAttribute('className');
        if (theHeaderMenuClass == null) { theHeaderMenuClass = theHeaderMenuName; }

        if (theHeaderMenuClass == 'hidden')
            {
            theHeaderMenu.setAttribute('class', 'default');
            theHeaderMenu.setAttribute('className', 'default');

            var newSrc  = newRoot + '_common/img/icon_menu_close.png';
            theHeaderMenuImage.setAttribute('src', newSrc);
            }
        else
            {
            theHeaderMenu.setAttribute('class', 'hidden');
            theHeaderMenu.setAttribute('className', 'hidden');

            var newSrc  = newRoot + '_common/img/icon_menu_open.png';
            theHeaderMenuImage.setAttribute('src', newSrc);
            }

        // Supress the browser's default behavior.
        return false;
        }
    }




//// Change the look and behavior of the Menu link in the site header.
function setHeaderMenu()
    {
    if ((document.getElementsByTagName) && (document.getElementById))
        {
        var theHeaderMenuLink  = document.getElementById('header_menu_link');
        var theHeaderMenuImage = document.getElementById('header_menu_image');
        var theHeaderMenu      = document.getElementById('header_menu');

        if (
               (theHeaderMenuLink)
            && (theHeaderMenuImage)
            && (theHeaderMenuImage.getAttribute)
            && (theHeaderMenuImage.setAttribute)
            && (theHeaderMenu)
            && (theHeaderMenu.getAttribute)
            && (theHeaderMenu.setAttribute)
           )
            {
            // Change the look of the link.
            var newRoot = theHeaderMenuImage.getAttribute('longdesc');
            var newSrc  = newRoot + '_common/img/icon_menu_open.png';
            theHeaderMenuImage.setAttribute('src', newSrc);

            // Change the behavior of the link.
            theHeaderMenuLink.onclick = function() { headerMenuOpenClose(theHeaderMenu, theHeaderMenuImage, newRoot); return false; }
            }
        }
    }




//// Attempt to force this site free should it get frame-jacked.
function unFrameJack()
    {
    if (top.location != self.location)
        {
        top.location.replace(self.location);
        }
    }




//// Call all the common functions for this site.
addToPage(unFrameJack);
addToPage(setHeaderMenu);
