!function(e,t){e.Webtrends&&!e.WTYT&&(WTYT=function(e,t){this.tag=e,this.pluginConfig=t,this.mode=this.pluginConfig.mode?this.pluginConfig.mode:"automatic",this.maindcsid=this.tag.dcsid,this.dcsid=this.pluginConfig.dcsid?this.pluginConfig.dcsid:this.tag.dcsid,this.activePlayers=[],this.activePlayerCount=0,this.unreadyPlayers=[],this.percentageIncrements=25,this.throttleInterval=500,this.throttledEvents=[],this.throttleTimeouts=[],this.errors=[]},WTYT.prototype={wrapYTCallback:function(){var e=this;if(window.onYouTubeIframeAPIReady){var t=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=function(){t(),e.startPlugin()}}else window.onYouTubeIframeAPIReady=function(){e.startPlugin()}},wrapYTPlayerReadyCallback:function(){var e=this;if(window.onYouTubePlayerReady){var t=window.onYouTubePlayerReady;window.onYouTubePlayerReady=function(){e.purgeUnreadyPlayers(),e.init_embed(),t()}}else window.onYouTubePlayerReady=function(){e.purgeUnreadyPlayers()}},startPlugin:function(){"automatic"===this.mode&&this.init_iFrame(),this.init_embed(),this.startProgressCheck()},init_iFrame:function(){for(var e=document.getElementsByTagName("IFRAME"),t=0;t<e.length;t++)if(e[t].src&&e[t].src.toLowerCase().indexOf("://www.youtube.com/embed/")>=0){var a=this;new YT.Player(e[t],{id:t,playerVars:{enablejsapi:1},events:{onReady:function(e){a.addActivePlayer(e.target)},onStateChange:Webtrends.ytTracker.iFrameStateChanged,onPlaybackQualityChange:Webtrends.ytTracker.iFrameQualityChanged}})}},init_embed:function(){var e=document.getElementsByTagName("OBJECT");if(e)for(var t=0;t<e.length;t++){var a=e[t].getAttribute("data");if(a&&a.toLowerCase().indexOf("://www.youtube.com/")>=0||e[t].Movie&&e[t].Movie.toLowerCase().indexOf("://www.youtube.com/")){if(objectPlayer=e[t],objectPlayer.hasOwnProperty("wtid"))continue;objectPlayer.getPlayerState?this.addEmbedPlayer(objectPlayer):this.unreadyPlayers[this.unreadyPlayers.length]=objectPlayer}}var r=document.getElementsByTagName("EMBED");if(r)for(t=0;t<r.length;t++){var n=r[t].getAttribute("src");if(n&&n.toLowerCase().indexOf("://www.youtube.com/")>=0){if(embedPlayer=r[t],embedPlayer.hasOwnProperty("wtid"))continue;embedPlayer.getPlayerState?this.addEmbedPlayer(embedPlayer):this.unreadyPlayers[this.unreadyPlayers.length]=embedPlayer}}},purgeUnreadyPlayers:function(){for(var e=0;e<this.unreadyPlayers.length;e++){var t=this.unreadyPlayers[e];t.getPlayerState&&(this.addEmbedPlayer(t),this.unreadyPlayers.splice(e,1))}},addEmbedPlayer:function(e){this.addActivePlayer(e),window["WT_embedPlayerStateChanged"+e.wtid]=function(t){Webtrends.ytTracker.embedStateChanged(t,e.wtid)},e.addEventListener("onStateChange","WT_embedPlayerStateChanged"+e.wtid),window["WT_WT_embedPlayerQualityChanged"+e.wtid]=function(){Webtrends.ytTracker.embedQualityChanged(e.wtid)},e.addEventListener("onPlaybackQualityChange","WT_WT_embedPlayerQualityChanged"+e.wtid)},addIFramePlayer:function(e){"manual"===this.mode&&(this.addActivePlayer(e),e.addEventListener("onStateChange",Webtrends.ytTracker.iFrameStateChanged),e.addEventListener("onPlaybackQualityChange",Webtrends.ytTracker.iFrameQualityChanged))},addActivePlayer:function(e){e.wtid=this.activePlayerCount,e.meta={},e.meta.eventCount=0,e.meta.lastTime=e.getCurrentTime(),e.meta.lastState=e.getPlayerState(),this.activePlayers[this.activePlayerCount]=e,this.activePlayerCount++,this.generateEvent(e,"impressionEvent",null)},qualityChanged:function(e){this.activePlayers[e.wtid].meta.eventCount>1&&this.generateEvent(e,"qualityEvent",null),Webtrends.ytTracker.activePlayers[e.wtid].meta.lastQualityChange=new Date},stateChanged:function(e,t){try{if(t!==YT.PlayerState.PLAYING&&t!==YT.PlayerState.PAUSED&&t!==YT.PlayerState.ENDED)return;if(e.meta.lastQualityChange&&(new Date).getTime()-e.meta.lastQualityChange.getTime()<1e3&&null!==e.meta.lastState&&e.meta.lastState!=YT.PlayerState.UNSTARTED&&e.meta.lastState!=YT.PlayerState.ENDED)return;this.generateEvent(e,"actionEvent",t)}catch(e){this.errors.push(e)}},generateEvent:function(e,t,a){try{var r={};if(r.WT={},r.player=e,"qualityEvent"!=t?(r.newState=a,r.eventTime=e.getCurrentTime()):(r.newState=this.activePlayers[e.wtid].meta.lastState,r.eventTime=this.activePlayers[e.wtid].meta.lastTime),r.eventType=t,r.quality=e.getPlaybackQuality(),r.WT["WT.yt_tv"]="@@TAGVERSION@@",r.throttle="actionEvent"===t,r.WT["WT.dl"]="impressionEvent"===t?40:41,"actionEvent"===t)if(e.meta.lastState===a)r.WT["WT.clip_ev"]="Seek",r.WT["WT.soc_action"]="YouTube: Seek";else switch(a){case YT.PlayerState.PLAYING:e.meta.lastState===YT.PlayerState.PAUSED?(r.WT["WT.clip_ev"]="Resume",r.WT["WT.soc_action"]="YouTube: Resume"):(r.WT["WT.clip_ev"]="Play",r.WT["WT.soc_action"]="YouTube: Play");break;case YT.PlayerState.PAUSED:r.WT["WT.clip_ev"]="Pause",r.WT["WT.soc_action"]="YouTube: Pause";break;case YT.PlayerState.ENDED:r.WT["WT.clip_ev"]="End",r.WT["WT.soc_action"]="YouTube: End"}if("actionEvent"===t||"progressEvent"===t||"qualityEvent"===t){r.WT["WT.clip_secs"]=e.getCurrentTime().toFixed();var n=e.getCurrentTime()/e.getDuration()*100;"progressEvent"!==t&&a!==YT.PlayerState.ENDED&&"Play"!==r.WT["WT.clip_ev"]||(r.WT["WT.clip_perc"]=Math.floor(n/this.percentageIncrements)*this.percentageIncrements)}r.WT["WT.clip_t"]=this.determinePlayerType(e);var i=this.parseIDFromUrl(e.getVideoUrl());r.WT["WT.clip_id"]=i,"qualityEvent"===t&&(r.WT["WT.clip_q"]=r.quality);var s="unknown";try{s=e.getVideoData().title}catch(e){}r.WT["WT.clip_n"]=s,"actionEvent"===t&&(r.WT["WT.soc_content"]=s),this.sendEvent(r)}catch(e){this.errors.push(e)}},sendEvent:function(e){if(!1!==e.throttle){this.throttledEvents[e.player.wtid]=e;var t=window.setTimeout(function(){Webtrends.ytTracker.sendThrottledEvent(e)},this.throttleInterval);return this.throttleTimeouts[e.player.wtid]&&window.clearTimeout(this.throttleTimeouts[e.player.wtid]),void(this.throttleTimeouts[e.player.wtid]=t)}this.activePlayers[e.player.wtid].meta.lastState=e.newState,this.activePlayers[e.player.wtid].meta.lastTime=e.eventTime,this.activePlayers[e.player.wtid].meta.eventCount++;var a=this;this.tag.dcsMultiTrack({args:e.WT,transform:function(e,t){e.dcsid=a.dcsid},finish:function(e,t){e.dcsid=a.maindcsid}})},sendThrottledEvent:function(e){this.throttledEvents[e.player.wtid]===e&&(this.throttledEvents[e.player.wtid]={},e.throttle=!1,Webtrends.ytTracker.sendEvent(e))},determinePlayerType:function(e){if(e.getDebugText){var t=e.getDebugText();return-1!==t.indexOf("Flash")||-1!==t.indexOf("flash")?"Flash":"html5"}return"unknown"},parseIDFromUrl:function(e){for(var t=e.split("/"),a=t[t.length-1].split("?"),r=a[a.length-1].split("&"),n=[],i=0;i<r.length;i++){var s=r[i].split("=");n[s[0]]=s[1]}return n.v?n.v:"unknown"},startProgressCheck:function(){window.setTimeout(function(){Webtrends.ytTracker.checkPlayerProgress(5e3)},5e3)},checkPlayerProgress:function(e){for(var t=0;t<this.activePlayers.length;t++){var a=this.activePlayers[t].getDuration(),r=this.activePlayers[t].meta.lastTime/a*100,n=this.activePlayers[t].getCurrentTime()/a*100,i=Math.floor(r/this.percentageIncrements);Math.floor(n/this.percentageIncrements)>i&&this.generateEvent(this.activePlayers[t],"progressEvent",this.activePlayers[t].getPlayerState())}window.setTimeout(function(){Webtrends.ytTracker.checkPlayerProgress(e)},e)},iFrameStateChanged:function(e){Webtrends.ytTracker.stateChanged(e.target,e.data)},embedStateChanged:function(e,t){Webtrends.ytTracker.stateChanged(Webtrends.ytTracker.activePlayers[t],e)},iFrameQualityChanged:function(e){Webtrends.ytTracker.qualityChanged(e.target)},embedQualityChanged:function(e){Webtrends.ytTracker.qualityChanged(Webtrends.ytTracker.activePlayers[e])}},WTYT_loader=function(e,t){Webtrends.ytTracker=new WTYT(e,t),Webtrends.addYTPlayer=function(e){Webtrends.ytTracker.addIFramePlayer(e)},window.YT?Webtrends.ytTracker.startPlugin():Webtrends.ytTracker.wrapYTCallback(),Webtrends.ytTracker.wrapYTPlayerReadyCallback()},Webtrends.registerPlugin("yt",WTYT_loader))}(window,window.document);